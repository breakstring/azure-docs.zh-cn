---
title: Azure 指标资源管理器的高级功能
description: 了解 Azure 指标资源管理器的高级用法。
author: vgorbenko
services: azure-monitor
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: vitalyg
ms.subservice: metrics
ms.openlocfilehash: 2f8dc9f53c36f59a152fc34361b3726ea2cc001c
ms.sourcegitcommit: 95c2cbdd2582fa81d0bfe55edd32778ed31e0fe8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/26/2021
ms.locfileid: "98797063"
---
# <a name="advanced-features-of-the-azure-metrics-explorer"></a>Azure 指标资源管理器的高级功能

> [!NOTE]
> 本文假设你熟悉 Azure Monitor 的 Azure 指标资源管理器功能的基本功能。 如果你是新用户，并且想要了解如何创建第一个指标图表，请参阅 [指标资源管理器](metrics-getting-started.md)入门。

在 Azure Monitor 中， [指标](data-platform-metrics.md) 是一系列经过一段时间收集和存储的度量值和计数。 度量值可以是标准 (也称为 "平台" ) 或自定义。 

标准指标由 Azure 平台提供。 它们反映了 Azure 资源的运行状况和使用情况统计信息。 

## <a name="resource-scope-picker"></a>资源范围选取器
资源范围选取器允许你查看单个资源和多个资源的指标。 以下各节介绍如何使用资源范围选取器。 

### <a name="select-a-single-resource"></a>选择单个资源
从 Azure Monitor 菜单或从资源的菜单的“监视”部分选择“指标”    。 然后选择 " **选择作用域** "，打开 "作用域选取器"。 

使用作用域选取器选择要查看其指标的资源。 如果从资源菜单打开 Azure 指标资源管理器，则应该填充范围。 

![显示如何打开资源范围选取器的屏幕截图。](./media/metrics-charts/scope-picker.png)

对于某些资源，一次只能查看一个资源的度量值。 在 " **资源类型** " 菜单中，这些资源位于 " **所有资源类型** " 部分。

![显示单个资源的屏幕截图。](./media/metrics-charts/single-resource-scope.png)

选择资源后，会看到包含该资源的所有订阅和资源组。

![显示可用资源的屏幕截图。](./media/metrics-charts/available-single-resource.png)

> [!TIP]
> 如果你想要同时查看多个资源的指标，或者要跨订阅或资源组查看指标，请选择 **投票赞成**。

如果对选择满意，请选择 " **应用**"。

### <a name="view-metrics-across-multiple-resources"></a>跨多个资源查看指标
某些资源类型可以查询多个资源的指标。 资源必须位于相同的订阅和位置。 在 " **资源类型** " 菜单顶部找到这些资源类型。 

有关详细信息，请参阅 [选择多个资源](metrics-dynamic-scope.md#select-multiple-resources)。

![显示跨资源类型的屏幕截图。](./media/metrics-charts/multi-resource-scope.png)

对于与多个资源兼容的类型，可以在一个或多个资源组中查询度量值。 有关详细信息，请参阅 [选择资源组或订阅](metrics-dynamic-scope.md#select-a-resource-group-or-subscription)。

## <a name="multiple-metric-lines-and-charts"></a>多个指标行和图表

在 Azure 指标资源管理器中，你可以创建绘制多个指标行或同时显示多个指标图表的图表。 此功能用于：

- 关联同一关系图上的相关指标，以查看一个值与另一个值的关系。
- 显示使用不同度量单位的度量值。
- 直观聚合和比较多个资源的指标。

例如，假设有5个存储帐户，并想知道它们一起使用了多少空间。 您可以创建一个 (堆积) 面积图，该图显示特定时间点的各个值和所有值的总和。

### <a name="multiple-metrics-on-the-same-chart"></a>同一图表上的多个指标

若要在同一图表中查看多个度量值，请先 [创建一个新的图表](metrics-getting-started.md#create-your-first-metric-chart)。 然后选择 " **添加度量值**"。 重复此步骤，在同一图表上添加另一个度量值。

> [!NOTE]
> 通常，图表不应混合使用不同度量单位的指标。 例如，避免将使用毫秒的一个度量值混合到使用 kb 的另一个。 还应避免混合其刻度差别明显不同的指标。 
>
> 在这些情况下，请考虑使用多个图表。 在指标资源管理器中，选择 " **添加图表** " 以创建新图表。

### <a name="multiple-charts"></a>多个图表

若要创建另一个使用不同指标的图表，请选择 " **添加图表**"。

若要重新排序或删除多个图表，请选择 **省略号 ("**) " 按钮打开 "图表" 菜单。 然后选择 "**上移**" **、"下移" 或 "****删除**"。

## <a name="aggregation"></a>聚合

向图表添加度量值时，指标资源管理器会自动应用默认聚合。 默认情况下，在基本方案中是有意义的。 但你可以使用不同的聚合来获得有关指标的更多见解。 

在图表上使用不同的聚合之前，应了解指标资源管理器处理它们的方式。 指标是在一段时间内捕获的一系列度量值 (或 "度量值" ) 。 绘制图表时，所选指标的值将基于时间粒度进行单独聚合。 

使用指标资源管理器的 [时间选取器面板](metrics-getting-started.md#select-a-time-range)选择时间粒度的大小。 如果未显式选择时间粒度，则默认情况下将使用当前选定的时间范围。 确定了时间粒度后，在每个时间粒度捕获的指标值将在图表上聚合，每个时间粒度一个数据点。

例如，假设某个图表显示 *服务器响应时间* 指标。 它在 *过去24小时* 内使用一段时间内的 *平均* 聚合。 在本示例中：

- 如果将时间粒度设置为30分钟，则会从48个聚合数据点绘制图表。 也就是说，折线图将图表绘图区中的48点连接 (每小时24小时 x 2 个数据点) 。 每个数据点都表示在每个相关的30分钟时间段内发生的服务器请求的所有捕获响应时间的 *平均值* 。
- 如果将时间粒度切换到15分钟，则会获得96个聚合数据点。  也就是说，每小时获取24小时 x 4 个数据点。

指标资源管理器具有五个基本统计聚合类型： sum、count、min、max 和 average。 *Sum* 聚合有时称为 *合计* 聚合。 对于许多指标，指标资源管理器会隐藏不相关且不能使用的聚合。

* **总和**：聚合间隔期间捕获的所有值的总和。

    ![Sum 请求的屏幕截图。](./media/metrics-charts/request-sum.png)

* **计数**：在聚合间隔期间捕获的度量值的数量。 
    
    当始终捕获值为1的指标时，计数聚合将等于 sum 聚合。 当指标跟踪不同事件的计数，并且每个度量值都表示一个事件时，这种情况很常见。 每次新请求到达时，代码都会发出一个指标记录。

    ![计数请求的屏幕截图。](./media/metrics-charts/request-count.png)

* **Average**：聚合间隔期间捕获的指标值的平均值。

    ![平均请求的屏幕截图。](./media/metrics-charts/request-avg.png)

* **最小** 值：聚合间隔期间捕获的最小值。

    ![最小请求的屏幕截图。](./media/metrics-charts/request-min.png)

* **Max**：聚合间隔期间捕获的最大值。

    ![最大请求的屏幕截图。](./media/metrics-charts/request-max.png)

## <a name="filters"></a>筛选器

您可以将筛选器应用于指标具有维度的图表。 例如，假设有一个具有 "响应类型" 维度的 "事务计数" 度量值。 此维度指示事务的响应是成功还是失败。 如果你筛选此维度，则只会显示成功的 (或仅) 的事务失败的图表行。 

### <a name="add-a-filter"></a>添加筛选器

1. 在图表上方，选择 " **添加筛选器**"。

2. 选择要筛选)  (属性的维度。

   ![该屏幕截图显示了可筛选的维度（属性）。](./media/metrics-charts/028.png)

3. 选择要应用于维度 (属性) 的运算符。 默认运算符为 = (等于) 

   ![显示可与筛选器一起使用的运算符的屏幕截图。](./media/metrics-charts/filter-operator.png)

4. 选择要在绘制图表时应用于筛选器的维度值 (此示例显示筛选出成功的存储事务) ：

   ![显示成功筛选的存储事务的屏幕截图。](./media/metrics-charts/029.png)

5. 选择筛选值后，在“筛选选择器”之外单击将其关闭。 现在图表将显示失败的存储事务数：

   ![显示失败的存储事务数的屏幕截图。](./media/metrics-charts/030.png)

6. 您可以重复步骤1-5，将多个筛选器应用于相同的图表。


## <a name="metric-splitting"></a>度量值拆分

您可以按维度拆分度量值，以可视化不同段的度量值比较。 拆分还有助于标识维度的外部段。

### <a name="apply-splitting"></a>应用拆分

1. 在图表上方，选择 " **应用拆分**"。
 
   > [!NOTE]
   > 具有多个度量值的图表不能使用拆分功能。 此外，尽管一个图表可以有多个筛选器，但它只能有一个拆分维度。

2. 选择要对图表进行分段的维度：

   ![屏幕截图，显示对图表进行分段所选的维度。](./media/metrics-charts/031.png)

   现在，图表会显示多个行，每个维度段一个行：

   ![该屏幕截图显示了多个折线图，每个维度部分均有一个。](./media/metrics-charts/segment-dimension.png)
   
3. 选择按选定维度拆分后要显示的值的数量限制。 默认限制为10，如上图所示。 限制范围为 1-50。
   
   ![显示拆分限制的屏幕截图，用于限制拆分后的值数。](./media/metrics-charts/segment-dimension-limit.png)
   
4. 选择段上的排序顺序：升序或降序。 默认选择为 "降序"。
   
   ![显示拆分值的排序顺序的屏幕截图。](./media/metrics-charts/segment-dimension-sort.png)

5. 在“分组选择器”之外单击以将其关闭。
   

   > [!NOTE]
   > 若要隐藏与方案无关的段并使图表更易于阅读，请在同一维度上同时使用筛选和拆分。

## <a name="locking-the-range-of-the-y-axis"></a>锁定 y 轴的范围

锁定值的范围 (y) 轴在显示大值的小波动的图表中变得非常重要。 

例如，从99.99% 到99.5% 的成功请求量中的删除可能表示服务质量显著降低。 但如果您使用的是默认图表设置，则注意小数值波动会很难甚至不可能。 在这种情况下，您可以将图表的最小边界锁定到99%，使小部分更明显。 

另一个示例是可用内存中的波动。 在此方案中，此值在技术上永远不会达到0。 将范围设置为较高的值可能会导致可用内存越小越好。 

若要控制 y 轴范围，请打开 "图表" 菜单 **(") "。** 然后选择 **图表设置** 以访问高级图表设置。

![突出显示图表设置选择内容的屏幕截图。](./media/metrics-charts/033.png)

修改 " **Y 轴范围** " 部分中的值，或选择 " **自动** " 以还原为默认值。
 
 ![突出显示 Y 轴范围部分的屏幕截图。](./media/metrics-charts/034.png)

> [!WARNING]
> 如果需要在使用 count、sum、min 或 max 聚合) 的情况下，通过使用 count、sum、min 或 max 聚合来为跟踪计数或总和的图表锁定 y 轴的边界 (，通常应指定固定时间粒度。 在这种情况下，不应依赖于自动默认设置。 
>
> 选择固定时间粒度，因为当用户调整浏览器窗口大小或更改屏幕分辨率后，当自动修改时间粒度时，图表值会发生更改。 所产生的时间粒度变化会影响图表的外观，使当前选定的 y 轴范围失效。

## <a name="line-colors"></a>线条颜色

配置图表后，将从默认调色板自动为图表线条分配颜色。 可以更改这些颜色。

若要更改图表线条的颜色，请在与图表相对应的图例中选择彩色条。 "颜色选取器" 对话框随即打开。 使用颜色选取器配置线条颜色。

![显示如何更改颜色的屏幕截图。](./media/metrics-charts/035.png)

将图表固定到仪表板时，会保留自定义颜色。 以下部分演示如何固定图表。

## <a name="pinning-to-dashboards"></a>固定到仪表板 

配置图表后，您可能需要将其添加到仪表板。 通过将图表固定到仪表板，你可以使其可供你的团队访问。 你还可以通过在其他监视遥测的上下文中查看来获得见解。

若要将配置的图表固定到仪表板，请在图表的右上角选择 " **固定到仪表板**"。

![显示如何将图表固定到仪表板的屏幕截图。](./media/metrics-charts/036.png)

## <a name="alert-rules"></a>警报规则

您可以使用可视化条件来创建基于指标的警报规则。 新警报规则将包含图表的目标资源、指标、拆分和筛选维度。 您可以使用 "警报规则创建" 窗格修改这些设置。

若要开始，请选择 " **新建警报规则**"。

![显示 "新建警报规则" 按钮以红色突出显示的屏幕截图。](./media/metrics-charts/042.png)

此时将打开 "警报规则创建" 窗格。 在窗格中，可以看到图表的度量尺寸。 窗格中的字段将预填充以帮助你自定义规则。

![显示 "规则创建" 窗格的屏幕截图。](./media/metrics-charts/041.png)

有关详细信息，请参阅 [创建、查看和管理指标警报](alerts-metric.md)。

## <a name="troubleshooting"></a>疑难解答

如果看不到图表上的任何数据，请查看以下疑难解答信息：

* 筛选器适用于窗格中的所有图表。 当你将焦点放在图表上时，请确保未设置筛选器以排除另一个图表上的所有数据。

* 若要在不同的图表上设置不同的筛选器，请在不同边栏选项卡中创建图表。 然后将图表保存为单独的收藏。 如果需要，可以将这些图表固定到仪表板，以便可以将它们一起查看。

* 如果按指标未定义的属性对图表进行分段，则图表不会显示任何内容。 请尝试清除分段（拆分），或选择其他属性。

## <a name="next-steps"></a>后续步骤

若要使用度量值创建可操作的仪表板，请参阅 [创建自定义 KPI 仪表板](../learn/tutorial-app-dashboards.md)。

 
