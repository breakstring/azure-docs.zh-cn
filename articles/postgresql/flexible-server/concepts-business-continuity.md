---
title: Azure Database for PostgreSQL-灵活服务器的业务连续性概述
description: 了解 Azure Database for PostgreSQL-灵活服务器的业务连续性概念
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: 341d3c6f0a2d84c2b7b725959db9f7e5dd80d3ff
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/26/2020
ms.locfileid: "92542958"
---
# <a name="overview-of-business-continuity-with-azure-database-for-postgresql---flexible-server"></a>Azure Database for PostgreSQL-灵活服务器的业务连续性概述

> [!IMPORTANT]
> Azure Database for PostgreSQL 灵活服务器以预览版提供

Azure Database for PostgreSQL 灵活的服务器中的 **业务连续性** 指的是一种机制、策略和过程，使企业能够在面临中断的情况下继续工作，尤其是对于其计算基础结构。 在大多数情况下，灵活的服务器将处理在云环境中可能发生的中断性事件，并使应用程序和业务流程保持运行。 但是，有些事件无法自动处理，例如：

- 用户意外删除或更新表中的行。
- 地震导致断电并暂时禁用数据中心或可用性区域。
- 修复 bug 或安全问题所需的数据库修补。

灵活的服务器提供了一些功能，这些功能可在发生计划内和计划外停机事件时保护数据并缓解任务关键数据库的停机时间。 在 Azure 基础结构的基础上构建，它已经提供强大的复原能力和可用性，灵活的服务器提供了业务连续性功能，可提供额外的故障保护、满足恢复时间要求并降低数据丢失的风险。 在设计应用程序时，应考虑停机容差，即恢复时间目标 (RTO) 和数据丢失风险，即恢复点目标 (RPO) 。 例如，与测试数据库相比，业务关键数据库需要更严格的运行时间要求。  

> [!IMPORTANT]
> 预览期间不提供 (SLA) 服务级别协议的运行时间百分比。 

下表说明了灵活的服务器提供的功能。


| **功能** | **说明** | **注意事项** |
| ---------- | ----------- | ------------ |
| **自动备份** | 灵活的服务器自动执行数据库文件的每日备份，并连续备份事务日志。 备份可保留最多35天的7天。 您将能够将您的数据库服务器还原到备份保持期内的任何时间点。 RTO 取决于要还原的数据的大小 + 执行日志恢复的时间。 最多可在12小时内完成。 有关更多详细信息，请参阅 [概念-备份和还原](./concepts-backup-restore.md)。 |备份数据保留在该区域中。 |
| **区域冗余高可用性** | 可以使用区域冗余高可用性 (HA) 配置来部署灵活的服务器，其中主服务器和备用服务器部署在区域内两个不同的可用性区域中。 这种 HA 配置可防止数据库发生区域级故障，还有助于减少计划内和计划外停机事件期间的应用程序停机时间。 在同步模式下，主服务器中的数据将复制到备用副本。 如果主服务器发生任何中断，服务器将自动故障转移到备用副本。 大多数情况下，RTO 应在 60s-120s 中。 RPO 应为零， () 不会丢失数据。 有关详细信息，请参阅 [概念-高可用性](./concepts-high-availability.md)。 | 在常规用途和内存优化计算层中受支持。 仅在有多个区域可用的区域中可用。 |
| **高级托管磁盘** | 数据库文件存储在高度持久且可靠的高级托管存储中。 这为具有自动数据恢复功能的可用性区域内存储的三个副本提供了数据冗余。 有关详细信息，请参阅 [托管磁盘文档](../../virtual-machines/managed-disks-overview.md)。 | 存储在可用性区域中的数据。 |
| **区域冗余备份** | 灵活的服务器备份自动并安全地存储在区域内的区域冗余存储中。 在设置服务器的区域级别故障期间，如果未使用区域冗余配置服务器，你仍可以使用不同区域中的最新还原点来还原数据库。 有关详细信息，请参阅 [概念-备份和还原](./concepts-backup-restore.md)。| 仅适用于有多个区域可用的区域。|


## <a name="planned-downtime-events"></a>计划停机事件
下面是一些计划内维护方案。 这些事件通常会产生长达几分钟的停机时间，而不会丢失数据。

| **方案** | **处理**|
| ------------------- | ----------- | 
| <b>计算缩放 (用户启动的) | 在计算缩放操作期间，允许完成活动检查点，客户端连接将耗尽，任何未提交的事务将被取消，存储分离，然后关闭。 使用缩放计算配置设置具有相同数据库服务器名称的新灵活服务器。 然后，将存储连接到新服务器，启动数据库，该数据库在需要时执行恢复，然后才能接受客户端连接。 |
| <b>扩展存储 (用户启动的)  | 当启动 "扩展存储" 操作时，将允许活动检查点完成，客户端连接将耗尽，所有未提交的事务将被取消，然后关闭。 存储将扩展到所需的大小，然后附加到新服务器。 如果需要，在接受客户端连接之前执行恢复。 请注意，不支持对存储大小进行缩减。 |
| <b>Azure 发起 (的新软件部署)  | 新功能的推出或 bug 修复会自动在服务的计划内维护过程中发生，并且你可以计划这些活动发生的时间。 有关详细信息，请查看你的 [门户](https://aka.ms/servicehealthpm)。 | 
| <b>Azure 启动)  (次版本升级 | Azure Database for PostgreSQL 会自动将数据库服务器修补到 Azure 确定的次要版本。 这是在服务的计划内维护过程中发生的。 数据库服务器将自动重新启动并带有新的次版本。 有关详细信息，请参阅这篇[文档](../concepts-monitoring.md#planned-maintenance-notification)。 你还可以查看你的 [门户](https://aka.ms/servicehealthpm)。| 

 如果为灵活的服务器配置了 **区域冗余高可用性** ，则灵活服务器将首先在备用服务器上执行缩放和维护操作。 有关详细信息，请参阅 [概念-高可用性](./concepts-high-availability.md)。

##  <a name="unplanned-downtime-mitigation"></a>缓解计划外停机

未计划的停机时间可能是由于意外中断（如基础硬件故障、网络问题和软件错误）导致的。 如果配置了高可用性的数据库服务器意外关闭，则会激活备用副本，并且客户端可以继续执行其操作。 如果未配置高可用性 (HA) ，则在重新启动尝试失败时，将自动预配新的数据库服务器。 尽管无法避免非计划的停机时间，但通过自动执行恢复操作而无需人工干预，灵活的服务器可帮助减少停机时间。 
   
### <a name="unplanned-downtime-failure-scenarios-and-service-recovery"></a>计划外停机：故障场景和服务恢复
下面是一些计划外故障方案和恢复过程。 

| **方案** | **恢复过程 [非 HA]** | **恢复过程 [HA]** |
| ---------- | ---------- | ------- |
| <B>数据库服务器故障 | 如果数据库服务器已关闭，Azure 将尝试重新启动数据库服务器。 如果此操作失败，则将在另一个物理节点上重新启动数据库服务器。  <br /> <br />  (RTO) 的恢复时间取决于各种因素，包括发生故障时的活动，例如，在执行数据库服务器启动过程中的大型事务和恢复量。 <br /> <br /> 所构建的使用 PostgreSQL 数据库的应用程序需要能够检测并重试丢弃的连接和失败的事务。 | 如果检测到数据库服务器故障，则服务器将故障转移到备用服务器，从而减少停机时间。 有关详细信息，请参阅 [HA 概念页](./concepts-high-availability.md)。 RTO 应为 60 120s，但不会丢失数据。 |
| <B>存储故障 | 对于任何与存储相关的问题（例如磁盘故障或物理块损坏），应用程序看不到任何影响。 当数据存储在三个副本中时，数据的副本将由幸存下来的存储提供服务。 损坏的数据块会自动修复，并自动创建数据的新副本。 | 对于任何罕见错误和不可恢复的错误（如整个存储不可访问），灵活的服务器将故障转移到备用副本以减少停机时间。 有关详细信息，请参阅 [HA 概念页](./concepts-high-availability.md)。 |
| <b> 逻辑/用户错误 | 若要从用户错误中恢复（如意外删除了表或数据未正确更新），必须 (PITR) 执行 [时间点恢复](../concepts-backup.md) 。 执行还原操作时，请指定自定义还原点，这是在发生错误之前的时间。<br> <br>  如果只需还原部分数据库或特定的表，而不是还原数据库服务器中的所有数据库，则可在新实例中还原数据库服务器，通过 [pg_dump](https://www.postgresql.org/docs/11/app-pgdump.html) 导出表，然后使用 [pg_restore](https://www.postgresql.org/docs/11/app-pgrestore.html) 将这些表还原到数据库中。 | 这些用户错误不受高可用性保护，因为所有更改都将同步复制到备用副本。 必须执行时点还原，才能从此类错误中恢复。 |
| <b> 可用性区域故障 | 若要从区域级别的故障中恢复，可以使用备份来执行时间点还原，并选择具有最新时间的自定义还原点来还原最新数据。 新的灵活服务器将部署在另一个不受影响的区域中。 还原所需的时间取决于以前的备份和要恢复的事务日志量。 | 灵活的服务器自动故障转移到120s 中的备用服务器，不会丢失数据。 有关详细信息，请参阅 [HA 概念页](./concepts-high-availability.md)。 | 
| <b> 区域故障 | 预览版尚不支持跨区域读取副本和备份功能的异地还原。 | |


> [!IMPORTANT]
> 已删除的服务器 **无法** 还原。 如果删除服务器，则属于该服务器的所有数据库也会被删除且不可恢复。 使用 [Azure 资源锁](../../azure-resource-manager/management/lock-resources.md)帮助防止意外删除服务器。


## <a name="next-steps"></a>后续步骤

-   了解 [区域冗余高可用性](./concepts-high-availability.md)
-   了解 [备份和恢复](./concepts-backup-restore.md)