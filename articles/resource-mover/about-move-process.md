---
title: 关于 Azure 资源转移器中的移动过程
description: 了解通过 Azure 资源转移器跨区域移动资源的过程
author: rayne-wiselman
manager: evansma
ms.service: resource-move
ms.topic: overview
ms.date: 09/09/2020
ms.author: raynew
ms.openlocfilehash: 5261904dd1ee7f280209015d8f756a055dfab57e
ms.sourcegitcommit: c95e2d89a5a3cf5e2983ffcc206f056a7992df7d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/24/2020
ms.locfileid: "95522934"
---
# <a name="about-the-move-process"></a>关于移动过程

[Azure 资源转移器](overview.md)帮助你在 Azure 区域之间移动 Azure 资源。 本文总结了资源转移器使用的组件，并介绍了移动过程。 


## <a name="components"></a>组件

在区域移动期间将使用这些组件。

组件 | **详细信息**
--- | ---
**资源转移器** |  资源转移器与 [Azure 资源提供程序](../azure-resource-manager/management/resource-providers-and-types.md)进行协调来安排资源在区域之间的移动。 资源转移器分析资源依赖关系，并在移动过程中维护和管理资源的状态。 
**移动集合** |  移动集合是一个 [Azure 资源管理器](../azure-resource-manager/management/overview.md)对象。<br/><br/> 移动集合是在区域移动过程中针对订阅中每个包含源区域和目标区域的配对组合创建的。 该集合包含要移动的资源的元数据和配置信息。<br/><br/>添加到移动集合的资源必须在同一订阅中，但可以在不同的资源组中。 
**移动资源** | 向移动集合添加资源时，资源转移器会将资源作为移动资源进行跟踪。<br/><br/> 资源转移器维护移动集合中的所有移动资源的信息，并维护源资源与目标资源之间的一对一关系。 
**依赖项** | 资源转移器验证你添加到集合的资源，并检查资源是否有任何不在移动集合中的依赖项。<br/><br/> 确定资源的依赖项后，可以将它们的依赖项添加到移动集合并移动它们，也可以选择目标区域中的现有替代资源。 开始移动之前，必须先解决所有依赖项。 



## <a name="move-region-process"></a>移动区域过程 

![显示了移动步骤的示意图](./media/about-move-process/move-steps.png)

每个移动资源都会经历所概述的步骤。

**步骤** | **详细信息** | **状态/问题**
--- | --- | --- 
**步骤 1：选择资源** | 选择资源。 资源将添加到移动集合中。 | 资源状态会变为“待准备”。<br/><br/> 如果资源具有依赖项，则“验证依赖项”会指示你需要向移动集合添加依赖项资源。
**步骤 2：验证依赖项** | 启动验证过程。<br/><br/> 如果验证显示依赖项资源处于挂起状态，请将其添加到移动集合。 <br/><br/> 请添加所有依赖项资源，即使你不想移动它们。 你稍后可以指出，要移动的资源应改用目标区域中的不同资源。<br/><br/> 请再次验证，直到没有待定依赖项为止。 | 添加所有依赖项并成功验证后，资源状态会变为“待准备”，而不会出现任何问题。
**步骤 3：准备** | 启动准备过程。 准备步骤取决于要移动的资源：<br/><br/> - **无状态资源**：无状态资源仅具有配置信息。 这些资源不需要连续复制数据来移动数据。 示例包括：Azure 虚拟网络 (VNet)、网络适配器、负载均衡器和网络安全组。 对于这种类型的资源，准备过程会生成一个 Azure 资源管理器模板。<br/><br/> - **有状态资源**：有状态资源既包含配置信息，又包含需要移动的数据。 示例包括 Azure VM 和 Azure SQL 数据库。 每个资源的准备过程不同。 它可能包括将源资源复制到目标区域。 | 启动会将资源状态变为“正在准备”。<br/><br/> 准备完成后，资源状态会变为“待启动移动”，不会出现问题。<br/><br/> 如果过程不成功，则状态会变为“准备失败”。
**步骤 4：启动移动** | 启动移动过程。 移动方法取决于资源类型：<br/><br/> - **无状态**：通常，对于无状态资源，移动过程会在目标区域中部署导入的模板。 此模板基于源资源设置，以及你对目标设置进行的任何手动编辑。<br/><br/> - **有状态**：对于有状态资源，移动过程可能涉及在目标区域中创建资源或启用副本。<br/><br/>  启动移动可能会导致源资源停机（仅适用于有状态资源）。 例如，VM 和 SQL。 | 启动移动会将状态转变为“正在启动移动”。<br/><br/> 如果启动移动成功，则会将资源状态变为“待提交移动”，不会出现问题。 <br/><br/> 如果移动过程不成功，则状态会变为“启动移动失败”。
**步骤 5 选项 1：放弃移动** | 在初始移动后，你可以决定是否继续进行完整移动。 如果不继续，你可以放弃移动，资源转移器会删除在目标中创建的资源。 在放弃过程之后，有状态资源的复制过程会继续。 此选项可用于测试。 | 放弃资源会将状态变为“正在放弃”。<br/><br/> 如果成功放弃，则会将状态变为“待启动移动”，不会出现问题。<br/><br/> 如果放弃失败，则会将状态变为“放弃移动失败”。 
**步骤 5 选项 2：提交移动** | 在初始移动后，如果要继续进行完整移动，请验证目标区域中的资源，并在准备就绪后提交移动。<br/><br/> 提交可能会导致源资源（例如 VM 或 SQL）变得无法访问（仅适用于有状态资源）。 | 如果提交移动，则资源状态会变为“正在提交移动”***。<br/><br/> 如果成功提交，则资源状态会显示为“提交移动完成”，不会出现问题。<br/><br/> 提交失败会将状态变为“提交移动失败”。
**步骤 6：删除源** | 在提交移动并验证目标区域中的资源之后，你可以删除源资源。 | 提交移动后，资源状态会变为“待删除源”。


## <a name="move-region-states"></a>移动区域状态

移动过程有许多状态，在每种状态下都可能会出现问题。 流程图汇总了这些状态和问题。

![可能的状态和问题的流程图](./media/about-move-process/process.png)


### <a name="dependency-analysis"></a>依赖项分析

当你执行移动过程时，系统在以下情况下可能会要求你验证依赖项：
- 某个资源使用了不在移动集合中的依赖项资源。
- 移动集合中的某个依赖项资源有其自己的依赖项，但这些依赖项不在移动集合中。
- 你修改了资源的目标设置，需要重新验证依赖项。


### <a name="remove-resources"></a>删除资源

如果你不想移动某个资源，可以将其从移动集合中删除。 通常会从集合中删除资源以及任何关联的操作或对象（例如复制操作或存储的模板）。 删除资源时，具体会发生什么情况取决于资源的类型，以及删除资源时该资源的状态。 [了解详细信息](remove-move-resources.md) 

## <a name="move-impact"></a>移动影响

下表汇总了跨区域移动时受影响的内容。

**行为** | **跨区域**
--- | --- | --- 
**数据** | 移动资源数据和元数据。<br/><br/> 将暂时存储元数据，以跟踪资源依赖项和操作的状态。
**资源** | 源资源保持不变以确保应用继续工作，可以选择在移动后将其删除。<br/><br/> 在目标区域中创建资源。
**移动过程** | 需要手动干预和监视的多步骤过程。
测试： | 对移动进行测试非常重要，因为在移动后，应用应当继续在目标区域中按预期方式工作。
**故障时间**： |  预计不会丢失数据，但需要停机一段时间来移动资源。



## <a name="next-steps"></a>后续步骤

将 Azure VM [移动](tutorial-move-region-virtual-machines.md)到另一区域。
将 Azure SQL 资源[移动](tutorial-move-region-sql.md)到另一区域。