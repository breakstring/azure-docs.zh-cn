---
title: 在 Azure IoT Central 中定义新的 IoT 设备类型 | Microsoft Docs
description: 本文介绍了如何在 Azure IoT Central 应用程序中创建新的 Azure IoT 设备模板作为解决方案生成器。 其中介绍了如何为类型定义遥测、状态、属性和命令。
author: dominicbetts
ms.author: dobett
ms.date: 12/06/2019
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.custom:
- contperf-fy21q1
- device-developer
ms.openlocfilehash: 22e948a0100f23dbddef8fc138576bb4b9372c77
ms.sourcegitcommit: d4734bc680ea221ea80fdea67859d6d32241aefc
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/14/2021
ms.locfileid: "100363196"
---
# <a name="define-a-new-iot-device-type-in-your-azure-iot-central-application"></a>在 Azure IoT Central 应用程序中定义新的 IoT 设备类型

本文适用于解决方案构建者和设备开发人员。 

设备模板是一种蓝图，用于定义连接到 [Azure IoT Central 应用程序](concepts-app-templates.md)的设备类型的特征和行为。

例如，构建人员可以为连接的风扇创建设备模板，该模板包括以下特征：

- 发送温度遥测
- 发送位置属性
- 发送风扇电机错误事件
- 发送风扇运行状态
- 提供可写的风扇速度属性
- 提供用于重启设备的命令
- 使用视图提供设备的总体视图

在此设备模板中，操作员可以创建和连接实际的风扇设备。 所有这些风扇都具有测量值、属性以及操作员用来监视和管理它们的命令。 操作员使用 [设备视图](#add-views) 和表单来与风扇设备交互。 设备开发人员使用模板来了解设备如何与应用程序交互。 若要了解详细信息，请参阅 [遥测、属性和命令有效负载](concepts-telemetry-properties-commands.md)。

> [!NOTE]
> 只有构建人员和管理员可以创建、编辑和删除设备模板。 任何用户都可以在“设备”页中基于现有的设备模板创建设备。

在 IoT Central 应用程序中，设备模板使用设备模型来描述设备的功能。 作为构建者，你在创建设备模板时有多种选择：

- 在 IoT Central 中设计设备模板，然后 [在设备代码中实现其设备型号](concepts-telemetry-properties-commands.md)。
- 从 [Azure IoT 认证设备目录](https://aka.ms/iotdevcat)导入设备模板。 按照 IoT Central 中的要求自定义设备模板。
> [!NOTE]
> IoT Central 要求在同一文件中包含所有引用接口的完整模型，则在从模型存储库导入模型时，使用关键字 "已扩展" 以获取完整版本。
例如， https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json

- 使用 [数字孪生定义语言 (DTDL) 版本 2](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md)创建设备模型。 Visual Studio code 的扩展支持创作 DTDL 模型。 若要了解详细信息，请参阅[安装并使用 DTDL 创作工具](../../iot-pnp/howto-use-dtdl-authoring-tools.md)。 然后，将模型发布到公共模型存储库。 若要了解详细信息，请参阅 [设备型号存储库](../../iot-pnp/concepts-model-repository.md)。 实现模型中的设备代码，并将实际设备连接到 IoT Central 的应用程序。 IoT Central 在公共存储库中查找和导入设备模型，并生成设备模板。 然后，你可以将 IoT Central 应用程序所需的任何云属性、自定义和视图添加到设备模板中。
- 使用 DTDL 创作设备型号。 基于模型实现设备代码。 手动将设备模型导入 IoT Central 应用程序，然后添加 IoT Central 应用程序所需的任何云属性、自定义和视图。

> [!TIP]
> IoT Central 要求在同一文件中包含所有引用接口的完整模型。 从模型存储库中导入模型时，请使用 *扩展* 的关键字获取完整版本。
> 例如， [https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json](https://devicemodels.azure.com/dtmi/com/example/thermostat-1.expanded.json) 。

你还可以使用 [REST API](/learn/modules/manage-iot-central-apps-with-rest-api/) 或 [CLI](howto-manage-iot-central-from-cli.md)将设备模板添加到 IoT Central 应用程序。

某些 [应用程序模板](concepts-app-templates.md) 已包括在应用程序模板支持的方案中非常有用的设备模板。 例如，请参阅 [存储分析体系结构](../retail/store-analytics-architecture.md)。

## <a name="create-a-device-template-from-the-device-catalog"></a>从设备目录创建设备模板

作为生成器，可以快速开始使用认证设备生成解决方案。 请参阅 [Azure IoT 设备目录](https://catalog.azureiotsolutions.com/alldevices)中的列表。 IoT Central 与设备目录集成，因此你可以从任何认证设备导入设备型号。 要在 IoT Central 中通过以下某一设备创建设备模板：

1. 在 IoT Central 应用程序中转到 " **设备模板** " 页。
1. 选择 " **+ 新建**"，然后从目录中选择任何已认证的设备。 IoT Central 基于此设备模型创建设备模板。
1. 将任何云属性、自定义或视图添加到设备模板中。
1. 选择“发布”，使操作员可以使用模板来查看和连接设备。

## <a name="create-a-device-template-from-scratch"></a>从头开始创建设备模板

设备模板包含：

- 指定设备实现的遥测、属性和命令的 _设备模型_ 。 这些功能被组织成一个或多个组件。
- 云属性，用于定义 IoT Central 应用程序存储的设备相关信息。 例如，云属性可记录设备最近一次维修的日期。 此信息从不与设备共享。
- _自定义_ 使生成器可以重写设备模型中的部分定义。 例如，构建人员可替代设备属性的名称。 属性名称显示在 IoT Central 视图和窗体中。
- _视图和表单_ 允许生成器创建一个 UI，该 UI 使操作员能够监视和管理连接到您的应用程序的设备。

要在 IoT Central 中创建设备模板：

1. 请转到 IoT Central 应用程序中的“设备模板”页。
1. 选择 " **+ 新**  >  **IoT 设备**"。 然后选择“下一步:自定义”。
1. 输入模板的名称，如 " **恒温器**"。 然后选择 " **下一步：查看** "，然后选择 " **创建**"。
1. IoT Central 创建一个空的设备模板，使您可以选择从头开始创建自定义模型或导入 DTDL 模型。

## <a name="manage-a-device-template"></a>管理设备模板

可从模板主页中重命名或删除模板。

向模板添加设备模型后，可以将其发布。 在发布模板之前，无法连接基于此模板的设备，供操作员在“设备”页中查看。

## <a name="create-a-capability-model"></a>创建功能模型

若要创建设备模型，可以执行以下操作：

- 使用 IoT Central 从头开始创建自定义模型。
- 导入 JSON 文件中的 DTDL 模型。 设备生成器可能已使用 Visual Studio Code 创作应用程序的设备模型。
- 从设备目录中选择一台设备。 此选项将导入制造商为此设备发布的设备型号。 像这样导入的设备模型会自动发布。

## <a name="manage-a-capability-model"></a>管理功能模型

创建设备模型后，可以：

- 向模型中添加组件。 模型必须至少有一个组件。
- 编辑模型元数据，例如其 ID、命名空间和名称。
- 删除模型。

## <a name="create-a-component"></a>创建组件

设备模型必须至少有一个默认组件。 组件是一种可重用的功能集合。

创建组件：

1. 中转到设备型号，然后选择 " **+ 添加组件**"。

1. 在 " **添加组件接口** " 页上，你可以：

    - 从头开始创建自定义组件。
    - 从 DTDL 文件导入现有组件。 设备生成器可能已使用 Visual Studio Code 为设备创作组件接口。

1. 创建组件后，选择 " **编辑标识** " 更改组件的显示名称。

1. 如果选择从头开始创建自定义组件，则可以添加设备功能。 设备功能包括遥测、属性和命令。

### <a name="telemetry"></a>遥测

遥测是从设备发送的值流，通常来自传感器。 例如，传感器可能会报告环境温度。

下表显示了遥测功能的配置设置：

| 字段 | 说明 |
| ----- | ----------- |
| 显示名称 | 视图和窗体上使用的遥测值的显示名称。 |
| 名称 | 遥测消息中字段的名称。 IoT Central 将根据显示名称生成此字段的值，但你可根据需要选择自己的值。 此字段必须为字母数字。 |
| 功能类型 | 遥测。 |
| 语义类型 | 遥测的语义类型，如温度、状态或事件。 选择的语义类型将决定以下哪些字段可用。 |
| 架构 | 遥测数据类型，如 double、string 或 vector。 可用的选项取决于语义类型。 架构不可用于事件和状态语义类型。 |
| 严重性 | 仅适用于事件语义类型。 严重性为“错误”、“信息”或“警告”。 |
| 状态值 | 仅适用于状态语义类型。 定义可能的状态值，其中每个状态值都具有显示名称、名称、枚举类型和值。 |
| 计价单位 | 遥测值的单位，例如 **mph**、 **%** 或 **&deg; C**。 |
| 显示单位 | 用于视图和窗体的显示单元。 |
| 注释 | 有关遥测功能的任何注释。 |
| 说明 | 遥测功能的说明。 |

### <a name="properties"></a>属性

属性表示时间点值。 例如，设备可使用属性来报告它尝试达到的目标温度。 可以从 IoT Central 设置可写属性。

下表显示了属性功能的配置设置：

| 字段 | 说明 |
| ----- | ----------- |
| 显示名称 | 视图和窗体上使用的属性值的显示名称。 |
| 名称 | 属性的名称。 IoT Central 将根据显示名称生成此字段的值，但你可根据需要选择自己的值。 此字段必须为字母数字。 |
| 功能类型 | 属性。 |
| 语义类型 | 属性的语义类型，如温度、状态或事件。 选择的语义类型将决定以下哪些字段可用。 |
| 架构 | 属性数据类型，如 double、string 或 vector。 可用的选项取决于语义类型。 架构不可用于事件和状态语义类型。 |
| 可写 | 如果该属性不是可写的，则设备可以将属性值报告给 IoT Central。 如果该属性是可写的，则设备可以将属性值报告给 IoT Central，IoT Central 可以将属性更新发送到设备。
| 严重性 | 仅适用于事件语义类型。 严重性为“错误”、“信息”或“警告”。 |
| 状态值 | 仅适用于状态语义类型。 定义可能的状态值，其中每个状态值都具有显示名称、名称、枚举类型和值。 |
| 计价单位 | 属性值的单位，如 **mph**、 **%** 或 **&deg; C**。 |
| 显示单位 | 用于视图和窗体的显示单元。 |
| 注释 | 有关属性功能的任何注释。 |
| 说明 | 属性功能的说明。 |

### <a name="commands"></a>命令

可从 IoT Central 调用设备命令。 命令可以选择将参数传递给设备，并接收来自设备的响应。 例如，你可以调用命令，在 10 秒内重启设备。

下表显示了命令功能的配置设置：

| 字段 | 说明 |
| ----- | ----------- |
| 显示名称 | 用于视图和窗体的命令的显示名称。 |
| 名称 | 命令的名称。 IoT Central 将根据显示名称生成此字段的值，但你可根据需要选择自己的值。 此字段必须为字母数字。 |
| 功能类型 | 命令。 |
| 注释 | 有关命令功能的任何注释。 |
| 说明 | 命令功能的说明。 |
| 请求 | 如果启用，则请求参数的定义包括：名称、显示名称、架构、单位和显示单位。 |
| 响应 | 如果启用，则命令响应的定义包括：名称、显示名称、架构、单位和显示单位。 |

若要了解有关设备如何实现命令的详细信息，请参阅 [遥测、property 和 command 负载 > 命令和长时间运行命令](concepts-telemetry-properties-commands.md#commands)。

#### <a name="offline-commands"></a>脱机命令

如果设备模板中命令的 "脱机" 选项启用 " **脱机** " 选项，则可以选择 "队列命令"。

此选项使用 IoT 中心云到设备的消息向设备发送通知。 若要了解详细信息，请参阅 IoT 中心文章 [发送云到设备的消息](../../iot-hub/iot-hub-devguide-messages-c2d.md)。

云到设备的消息：

- 是从解决方案到设备的单向通知。
- 保证至少一次消息送达。 IoT 中心将云到设备的消息保留在每个设备队列中，从而确保可根据连接和设备故障进行恢复。
- 要求设备实现消息处理程序以处理云到设备的消息。

> [!NOTE]
> 此选项仅在 IoT Central web UI 中可用。 如果从设备模板导出模型或组件，则不包含此设置。

## <a name="manage-a-component"></a>管理组件

如果尚未发布该组件，则可以编辑该组件定义的功能。 发布组件后，如果要进行任何更改，则必须创建新版本的设备模板并使 [组件版本](howto-version-device-template.md)。 可在“自定义”部分中进行不需要版本控制的更改，例如显示名称或单位。

如果要在其他功能模型中重复使用该组件，还可以将其导出为 JSON 文件。

## <a name="add-cloud-properties"></a>添加云属性

使用云属性在 IoT Central 中存储设备相关信息。 云属性从不发送至设备。 例如，可以使用云属性来存储已安装设备的客户的名称或设备的最近一次维修日期。

下表显示了云属性的配置设置：

| 字段 | 说明 |
| ----- | ----------- |
| 显示名称 | 用于视图和窗体的云属性值的显示名称。 |
| 名称 | 云属性的名称。 IoT Central 将根据显示名称生成此字段的值，但你可根据需要选择自己的值。 |
| 语义类型 | 属性的语义类型，如温度、状态或事件。 选择的语义类型将决定以下哪些字段可用。 |
| 架构 | 云属性数据类型，如 double、string 或 vector。 可用的选项取决于语义类型。 |

## <a name="add-customizations"></a>添加自定义项

需要修改导入的组件或向功能中添加特定于 IoT Central 的功能时，可使用自定义。 只能自定义不会中断组件兼容性的字段。 例如，可以：

- 自定义功能的显示名称和单位。
- 添加在图表上显示值时要使用的默认颜色。
- 指定属性的初始值、最小值和最大值。

无法自定义功能名称或功能类型。 如果在 " **自定义** " 部分中无法进行更改，则需要为设备模板和组件设置版本以修改功能。

### <a name="generate-default-views"></a>生成默认视图

生成默认视图是可视化重要设备信息的快捷方法。 最多为设备模板生成三个默认视图：

- **命令**：包含设备命令的视图，允许操作员将其调度到设备。
- **概述**：包含设备遥测的视图，显示图表和指标。
- **关于**：包含设备信息的视图，显示设备属性。

选择 " **生成默认视图**" 后，会看到它们已自动添加到设备模板的 " **视图** " 部分下。

## <a name="add-views"></a>添加视图

将视图添加到设备模板，使操作员能够使用图表和指标来可视化设备。 一个设备模板可以有多个视图。

向设备模板添加视图：

1. 转到设备模板并选择“视图”。
1. 选择“可视化设备”。
1. 在 " **视图名称**" 中输入视图的名称。
1. 从静态、属性、云属性、遥测和命令磁贴的列表向视图添加磁贴。 拖放要添加到视图的磁贴。
1. 若要在单个图表磁贴上绘制多个遥测值，请选择各个遥测值，然后选择“合并”。
1. 配置添加的每个磁贴，以自定义其显示数据的方式。 通过选择齿轮图标或选择 "图表" 磁贴上的 " **更改配置** " 来访问此选项。
1. 排列视图上的图块并调整其大小。
1. 保存更改。

### <a name="configure-preview-device-to-view"></a>配置要查看的预览设备

若要查看和测试视图，请选择 " **配置预览版设备**"。 此功能使你可以查看在你的操作员发布后可以看到的视图。 使用此功能来验证您的视图是否显示正确的数据。 可从以下选项中进行选择：

- 无预览设备。
- 为设备模板配置的真实测试设备。
- 应用程序中的现有设备（通过使用设备 ID）。

## <a name="add-forms"></a>添加窗体

通过查看和设置属性，将窗体添加到设备模板，使操作员可以管理设备。 操作员只能编辑云属性和可写设备属性。 设备模板可具有多个窗体。

要将窗体添加到设备模板：

1. 转到设备模板并选择“视图”。
1. 选择“编辑设备和云数据”。
1. 在“窗体名称”中输入窗体的名称。
1. 选择用于对窗体进行布局的列数。
1. 将属性添加到窗体上的现有节，或选择属性并选择“添加节”。 使用这些节对窗体上的属性进行分组。 可向某一节添加标题。
1. 配置窗体上的每个属性以自定义其行为。
1. 排列窗体上的属性。
1. 保存更改。

## <a name="publish-a-device-template"></a>发布设备模板

必须先发布设备模板，然后才能连接实现设备型号的设备。

发布设备模板后，只能对设备型号进行有限的更改。 若要修改组件，需要 [创建并发布新版本](./howto-version-device-template.md)。

若要发布设备模板，请转到你的设备模板，然后选择“发布”。

在你发布设备模板后，操作员可以转到“设备”页，并添加使用此设备模板的真实或模拟设备。 你可以在进行更改时继续修改并保存设备模板。 如果要将这些更改推送给操作员，以便在“设备”页下查看，则必须每次都选择“发布”。

## <a name="next-steps"></a>后续步骤

如果你是一名设备开发人员，建议下一步是了解 [设备模板版本控制](./howto-version-device-template.md)。
