---
title: 教程 - 在 Azure IoT Central 中定义新的网关设备类型 | Microsoft Docs
description: 本教程向构建人员介绍如何在 Azure IoT Central 应用程序中定义新的 IoT 网关设备类型。
author: rangv
ms.author: rangv
ms.date: 10/22/2019
ms.topic: tutorial
ms.service: iot-central
services: iot-central
ms.custom: mvc
manager: peterpr
ms.openlocfilehash: e42e1791693342592e391a14422b1441c9cbbd31
ms.sourcegitcommit: d1b0cf715a34dd9d89d3b72bb71815d5202d5b3a
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/08/2021
ms.locfileid: "99832379"
---
# <a name="tutorial---define-a-new-iot-gateway-device-type-in-your-azure-iot-central-application"></a>教程 - 在 Azure IoT Central 应用程序中定义新的 IoT 网关设备类型

本文适用于解决方案构建者和设备开发人员。 

本教程向解决方案构建者介绍如何使用网关设备模板在 IoT Central 应用程序中定义网关设备。 然后配置多个下游设备，这些设备通过网关设备连接到 IoT Central 应用程序。 

在本教程中，你将创建一个“智能建筑物”网关设备模板。  “智能建筑物”网关设备与其他下游设备发生关系。 

![网关设备与下游设备之间的关系示意图](./media/tutorial-define-gateway-device-type/gatewaypattern.png)

除了使下游设备能够与 IoT Central 应用程序通信以外，网关设备还可以：

* 发送自身的遥测数据，例如温度。
* 响应操作员做出的可写属性更新。 例如，操作员可能会更改遥测数据的发送间隔。
* 响应命令，例如重新启动设备。

> [!div class="checklist"]
> 创建下游设备模板创建网关设备模板发布设备模板创建模拟设备

## <a name="prerequisites"></a>先决条件

若要完成本教程，需要[创建一个 Azure IoT Central 应用程序](./quick-deploy-iot-central.md)。

## <a name="create-downstream-device-templates"></a>创建下游设备模板

本教程使用“S1 传感器”设备和“RS40 占位传感器”设备的设备模板来生成模拟的下游设备。  

若要创建“S1 传感器”设备的设备模板： 

1. 在左窗格中选择“设备模板”  。 然后选择 **+** 开始添加模板。

1. 向下滚动，直到看到“S1 传感器”设备的磁贴。  选择该磁贴，然后选择“下一步:  自定义”。

1. 在“复查”页上，选择“创建”将该设备模板添加到应用程序。   

若要创建“RS40 占位传感器”设备的设备模板： 

1. 在左窗格中选择“设备模板”  。 然后选择 **+** 开始添加模板。

1. 向下滚动，直到看到“RS40 占位传感器”设备的磁贴。  选择该磁贴，然后选择“下一步:  自定义”。

1. 在“复查”页上，选择“创建”将该设备模板添加到应用程序。   

现已创建两个下游设备类型的设备模板：

![下游设备的设备模板](./media/tutorial-define-gateway-device-type/downstream-device-types.png)


## <a name="create-a-gateway-device-template"></a>创建网关设备模板

在本教程中，你将从头开始创建网关设备的设备模板。 稍后将使用此模板在应用程序中创建模拟的网关设备。

若要将新的网关设备模板添加到应用程序：

1. 在左窗格中选择“设备模板”  。 然后选择 **+** 开始添加模板。

1. 在“选择模板类型”页上选择“IoT 设备”磁贴，然后选择“下一步:    自定义”。

1. 在“自定义设备”页上，选中“网关设备”复选框。  

1. 在“查看”页上，选择“创建”   。 

1. 输入“智能建筑物网关设备”作为模板名称。 

1. 在“创建功能模型”页上，选择“自定义”磁贴。  

1. 选择 **+** 添加接口。  选择“设备信息”标准接口。 

### <a name="add-relationships"></a>添加关系

接下来，将关系添加到下游设备模板中：

1. 在“智能建筑物网关设备”模板中，选择“关系”。  

1. 选择“+ 添加关系”。  输入“环境传感器”作为显示名称，选择“S1 传感器”作为目标。  

1. 再次选择“+ 添加关系”。  输入“占位传感器”作为显示名称，选择“RS40 占位传感器”作为目标。  

1. 选择“保存”。 

![智能建筑物网关设备模板，其中显示了关系](./media/tutorial-define-gateway-device-type/relationships.png)

### <a name="add-cloud-properties"></a>添加云属性

网关设备模板可以包含云属性。 云属性仅存在于 IoT Central 应用程序中，永远不会与设备相互发送和接收信息。

若要将云属性添加到“智能建筑物网关设备”模板： 

1. 在“智能建筑物网关设备”模板中，选择“云属性”。  

1.  使用下表中的信息将两个云属性添加到网关设备模板。

    | 显示名称      | 语义类型 | 架构 |
    | ----------------- | ------------- | ------ |
    | 最后维修日期 | 无          | Date   |
    | 客户名称     | 无          | 字符串 |

2. 选择“保存”。 

### <a name="create-views"></a>创建视图

构建人员可将应用程序自定义为向操作员显示有关环境传感器设备的信息。 完成自定义后，操作员可以管理连接到应用程序的环境传感器设备。 可为操作员创建两种类型的视图来让他们与设备交互：

* 用于查看和编辑设备与云属性的窗体。
* 用于可视化设备的仪表板。

若要为“智能建筑物网关设备”模板生成默认视图： 

1. 在“智能建筑物网关设备”模板中，选择“视图”。  

1. 选择“生成默认视图”磁贴，并确保选择所有选项。 

1. 选择“生成默认仪表板视图”。 

## <a name="publish-the-device-template"></a>发布设备模板

需要先发布设备模板，然后才能创建模拟的网关设备或连接真实的网关设备。

若要发布网关设备模板：

1. 在“设备模板”页中选择“智能建筑物网关设备”模板。  

2. 选择“发布”  。

3. 在“发布设备模板”对话框中，选择“发布”   。

发布设备模板后，它将显示在“设备”页上，操作员可以看到它。  在发布的设备模板中，除非创建新的版本，否则无法编辑设备模型。 但是，可以在发布的设备模板中更新云属性、自定义项和视图。 这些更新不会导致创建新版本。 进行任何更改后，选择“发布”将这些更改推送给操作员。 

## <a name="create-the-simulated-devices"></a>创建模拟设备

本教程使用模拟的下游设备和模拟的网关设备。

若要创建模拟的网关设备：

1. 在“设备”页上的设备模板列表中，选择“智能建筑物网关设备”。  

1. 选择 **+** 开始添加新设备。

1. 保留生成的“设备 ID”和“设备名称”。   确保“模拟”切换开关为“打开”。   选择“创建”  。

若要创建模拟的下游设备：

1. 在“设备”页上的设备模板列表中，选择“RS40 占位传感器”。  

1. 选择 **+** 开始添加新设备。

1. 保留生成的“设备 ID”和“设备名称”。   确保“模拟”切换开关为“打开”。   选择“创建”  。

1. 在“设备”页上的设备模板列表中，选择“S1 传感器”。  

1. 选择 **+** 开始添加新设备。

1. 保留生成的“设备 ID”和“设备名称”。   确保“模拟”切换开关为“打开”。   选择“创建”  。

![应用程序中的模拟设备](./media/tutorial-define-gateway-device-type/simulated-devices.png)

### <a name="add-downstream-device-relationships-to-a-gateway-device"></a>将下游设备关系添加到网关设备

在应用程序中创建模拟设备后，接下来可以在下游设备与网关设备之间创建关系：

1. 在“设备”页上的设备模板列表中选择“S1 传感器”，然后选择模拟的“S1 传感器”设备。   

1. 选择“连接到网关”。 

1. 在“连接到网关”对话框中选择“智能建筑物网关设备”模板，然后选择前面创建的模拟实例。  

1. 选择“加入”  。

1. 在“设备”页上的设备模板列表中选择“RS40 占位传感器”，然后选择模拟的“RS40 占位传感器”设备。   

1. 选择“连接到网关”。 

1. 在“连接到网关”对话框中选择“智能建筑物网关设备”模板，然后选择前面创建的模拟实例。  

1. 选择“加入”  。

这两个模拟的下游设备现在都已连接到模拟的网关设备。 如果导航到网关设备的“下游设备”视图，可以看到相关的下游设备： 

![下游设备视图](./media/tutorial-define-gateway-device-type/downstream-device-view.png)

选择网关设备模板和网关设备实例，然后选择“联接”  。

## <a name="clean-up-resources"></a>清理资源

[!INCLUDE [iot-central-clean-up-resources](../../../includes/iot-central-clean-up-resources.md)]

## <a name="next-steps"></a>后续步骤

在本教程中，你了解了如何执行以下操作：

* 创建新的 IoT 网关作为设备模板。
* 创建云属性。
* 创建自定义项。
* 定义设备遥测的可视化效果。
* 添加关系。
* 发布设备模板。

接下来，设备开发人员可以了解如何：

> [!div class="nextstepaction"]
> [将 Azure IoT Edge 设备添加到 Azure IoT Central 应用程序](tutorial-add-edge-as-leaf-device.md)
