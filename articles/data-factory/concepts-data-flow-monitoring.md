---
title: 监视映射数据流
description: 如何在 Azure 数据工厂中直观地监视地图数据流
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 11/22/2020
ms.openlocfilehash: 9ca5ea5cdebe297af5081ae6e219935c56ba942e
ms.sourcegitcommit: 1bf144dc5d7c496c4abeb95fc2f473cfa0bbed43
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/24/2020
ms.locfileid: "96004853"
---
# <a name="monitor-data-flows"></a>监视数据流

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

完成数据流的生成和调试之后，需要在管道上下文中将数据流安排为按计划执行。 可以使用触发器从 Azure 数据工厂计划管道。 或者，可以使用 Azure 数据工厂管道生成器中的“立即触发”选项执行单次运行，以便在管道上下文中测试数据流。

执行管道时，可以监视该管道及其包含的所有活动，包括数据流活动。 在 Azure 数据工厂 UI 的左侧面板中单击监视图标。 可以看到下面所示的屏幕。 使用突出显示的图标可以深入到管道中的活动，包括数据流活动。

![屏幕截图显示了为管道选择的图标以获取详细信息。](media/data-flow/mon001.png "数据流监视")

还可以看到此级别的统计信息，包括运行次数和状态。 活动级别的运行 ID 不同于管道级别的运行 ID。 上一级别的运行 ID 适用于管道。 选择眼镜图标可以查看有关数据流执行的深入详细信息。

![屏幕截图显示了眼镜图标，以查看数据流执行的详细信息。](media/data-flow/monitoring-details.png "数据流监视")

在图形节点监视视图中，可以看到数据流图形的简化只读版本。

![屏幕截图显示图形的仅查看版本。](media/data-flow/mon003.png "数据流监视")

下面是有关从 ADF 监视屏幕监视数据流性能的视频概述：

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4u4mH]

## <a name="view-data-flow-execution-plans"></a>查看数据流执行计划

在 Spark 中执行数据流时，Azure 数据工厂会根据数据流的完整性确定最佳代码路径。 此外，执行路径可能出现在不同的横向扩展节点和数据分区上。 因此，监视图形表示流的设计，它考虑到了转换的执行路径。 选择单个节点时，可以看到“分组”，它们表示在群集上统一执行的代码。 看到的计时和计数表示相对于设计中各个步骤的组。

![屏幕截图显示数据流的页面。](media/data-flow/mon004.png "数据流监视")

* 在监视窗口中选择空白区域时，底部窗格中的统计信息会显示每个接收器的计时和行数，以及生成转换沿袭的接收器数据的转换。

* 选择单个转换时，右侧面板会显示其他反馈，其中显示了分区统计信息、列数、偏斜度（数据在分区之间的分布均匀度）和峰度（数据的峰度）。

* 在节点视图中选择“接收器”时，可以看到列沿袭。 在整个数据流中，可通过三种不同的方法来累积要载入接收器的列。 它们分别是：

  * 计算：使用列进行条件处理，或者在数据流中的表达式内使用列，但不将其载入接收器
  * 派生：列是在流中生成的新列，即，它不存在于源中
  * 映射：列来源于源，你要将它映射到接收器字段
  * 数据流状态：执行的当前状态
  * 群集启动时间：为数据流执行获取 JIT Spark 计算环境所需的时间量
  * 转换次数：在流中执行的转换步骤数
  
![屏幕截图显示 "刷新" 选项。](media/data-flow/monitornew.png "数据流监视（新）")

## <a name="total-sink-processing-time-vs-transformation-processing-time"></a>总接收器处理时间与转换处理时间

每个转换阶段都包括在每个分区执行时间汇总后完成该阶段的总时间。 单击接收器时，将显示 "接收器处理时间"。 此时间包括转换时间 *和* 将数据写入目标存储所需的 i/o 时间的总和。 接收器处理时间与转换总数之间的差异是写入数据的 i/o 时间。

如果在 ADF 管道监视视图中打开数据流活动的 JSON 输出，还可以查看每个分区转换步骤的详细计时。 JSON 包含每个分区的毫秒计时，而 UX 监视视图是添加分区的聚合计时：

```
 {
     "stage": 4,
     "partitionTimes": [
          14353,
          14914,
          14246,
          14912,
          ...
         ]
}
```

### <a name="post-processing-time"></a>后处理时间

当你在映射中选择接收器转换图标时，右侧的滑动面板将在底部显示名为 "post 处理时间" 的其他数据点。 这是加载、转换和写入数据 *后* 在 Spark 群集上执行作业所花费的时间。 此时间可能包括关闭连接池、驱动程序关闭、删除文件、合并文件，等等。当你在流中执行操作（如 "移动文件" 和 "输出到单个文件"）时，你可能会看到 post 处理时间值增加。
  
## <a name="error-rows"></a>错误行

如果在数据流接收器中启用错误行处理，则会在监视输出中反映出来。 将接收器设置为 "错误时报告成功" 时，当你单击 "接收器监视" 节点时，监视输出将显示 "成功" 和 "失败" 行的数目。

![屏幕截图显示错误行。](media/data-flow/error-row-2.png "错误行监视成功")

当您选择 "错误时报告失败" 时，将仅在活动监视输出文本中显示相同的输出。 这是因为数据流活动将返回 "执行失败"，并且 "详细监视" 视图将不可用。

![屏幕截图显示活动中的错误行。](media/data-flow/error-rows-4.png "错误行监视失败")

## <a name="monitor-icons"></a>监视图标

此图标表示转换数据已在群集中缓存，因此计时和执行路径已考虑到这种情况：

![屏幕截图显示磁盘图标。](media/data-flow/mon005.png "数据流监视")

在转换中还会看到绿色的圆圈图标。 它们表示数据流入的接收器数目。
