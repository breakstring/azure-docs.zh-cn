---
title: Azure Vm 上的 SQL Server 的 SQL 漏洞评估
description: 介绍 Azure 虚拟机上运行的 SQL Server 数据库的 SQL 漏洞评估。
services: virtual-machines-windows
author: MashaMSFT
ms.service: virtual-machines-sql
ms.subservice: security
ms.topic: conceptual
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 12/02/2020
ms.author: mathoma
ms.openlocfilehash: 817203b8e795ce15c8c48c18bc7b9a46217dc93a
ms.sourcegitcommit: dfc4e6b57b2cb87dbcce5562945678e76d3ac7b6
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/12/2020
ms.locfileid: "97356697"
---
# <a name="sql-vulnerability-assessment-for-sql-server-on-azure-vms"></a>Azure Vm 上的 SQL Server 的 SQL 漏洞评估
[!INCLUDE[appliesto-sqlvm](../../includes/appliesto-sqlvm.md)]

 (VA) 的 SQL 漏洞评估是一种易于配置的服务，可以发现、跟踪和帮助您修正潜在的数据库漏洞。 使用它在 Azure Vm 上主动提高你的 SQL Server 的数据库安全性。 

漏洞评估是 [Azure Defender for SQL](../../database/azure-defender-for-sql.md) 产品/服务（高级 SQL 安全功能的统一包）的一部分。 可以通过用于 SQL 的中央 Azure Defender 或 Azure 安全中心访问和管理漏洞评估。 

## <a name="overview"></a>概述

 (VA) 的 SQL 漏洞评估是一种服务，可提供安全状态的可见性。 漏洞评估包括用于解决安全问题和增强数据库安全性的可行步骤。 此工具有助于： 

- 满足必须生成数据库扫描报告的符合性要求。 
- 满足数据隐私标准。 
- 监视变化难以跟踪的动态数据库环境。 

漏洞评估是一种扫描服务，它采用标志安全漏洞的规则知识库。 它突出显示了与最佳做法（如配置错误、权限过多以及未受保护的敏感数据）的偏差。 

这些规则基于 Microsoft 的最佳做法，并专注于对数据库及其重要数据有最大风险的安全问题。 它们涵盖了数据库级别的问题以及服务器级别的安全问题，例如服务器防火墙设置和服务器级别的权限。 这些规则还体现了各个监管机构提出的许多要求，旨在满足它们的符合性标准。 

扫描结果包括旨在解决每个问题的可操作步骤，并提供自定义修正脚本（若适用）。 可以通过设置以下各项的可接受基线，来为环境自定义评估报告： 

- 权限配置 
- 功能配置 
- 数据库设置 

## <a name="enable-sql-va"></a>启用 SQL VA

为计算机上的 SQL Server 启用 Azure Defender 以实现漏洞评估。 

若要将 Azure Defender 用于 SQL Server，请执行以下步骤：

1. [安装 SQL IaaS 代理扩展](sql-agent-extension-manually-register-single-vm.md)
1. [启用 Log Analytics 代理的自动预配](../../../security-center/security-center-enable-data-collection.md#auto-provision-mma)
1. [启用可选的安全中心计划](../../../security-center/defender-for-sql-usage.md#step-2-enable-the-optional-plan-in-security-centers-pricing-and-settings-page)

由于漏洞评估是适用于 SQL 的 Azure Defender 的一部分，因此在虚拟机上启用 Azure Defender 后，将每隔12小时自动扫描数据库，以确定安全漏洞。 结果将发送到 Azure 安全中心，以获取受 Azure Defender for SQL 保护的 SQL 数据空间的集中聚合视图。 

> [!NOTE]
> 扫描是轻型、安全的，每个数据库只需几秒钟即可运行，并且完全是只读的。 此功能不会对数据库做出任何更改。 

## <a name="view-report"></a>查看报表

数据库报表提供安全状态的概述。 其中会列出发现的问题个数及其各自的严重性。 结果包括未遵循最佳做法的警告，以及安全相关设置（例如数据库主体和角色及其相关权限）的快照。  

若要查看报表，请执行以下步骤：

1. 在 Azure 门户中转到 [Azure 安全中心](https://ms.portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) 。
1. 在 "**常规**" 菜单中选择 "**建议**"： 

   :::image type="content" source="media/sql-vulnerability-assessment-enable/recommendations-in-security-center.png" alt-text="从 Azure 门户中的 &quot;Azure 安全中心&quot; 下的 &quot;设置&quot; 下，中转到建议":::

1. 向下滚动到建议，然后展开 " **修正漏洞**"。
1. **应修正计算机上的 SQL server 上的漏洞评估发现**。 

   :::image type="content" source="media/sql-vulnerability-assessment-enable/report-in-security-center.png" alt-text="在 Azure 安全中心的 &quot;建议&quot; 边栏选项卡中查看报表":::

此页显示为订阅中的所有 SQL Server Vm 标识的安全漏洞的聚合。 


## <a name="analyze-results"></a>分析结果

查看结果，并确定在您的环境中为真正安全问题的报告中的结果。 深入查看每个失败的结果，了解该结果的影响，以及每个安全检查失败的原因。  

:::image type="content" source="media/sql-vulnerability-assessment-enable/sample-report.png" alt-text="查看结果，并确定在您的环境中为真正安全问题的报告中的结果。":::

## <a name="set-baseline"></a>设置基线 

查看评估结果时，可以将结果标记为环境中可接受的基线。 基线其实就是自定义结果的报告方式。 与基线匹配的结果被视为通过后续扫描。 建立基线安全状态后，漏洞评估只会报告与基线的偏差。 这样，你可以专注于处理相关问题。 

:::image type="content" source="media/sql-vulnerability-assessment-enable/analyze-report-for-details.png" alt-text="查看评估结果时，可以将结果标记为环境中可接受的基线。":::

## <a name="export-results"></a>导出结果

使用 Azure 安全中心的 [连续导出](../../../security-center/continuous-export.md) 功能将漏洞评估结果导出到 Azure 事件中心或 Log Analytics 工作区。 


## <a name="next-steps"></a>后续步骤

若要了解详细信息，请参阅 [AZURE sql 中的 Sql 漏洞评估](../../database/sql-vulnerability-assessment.md)，并 [使用 azure 安全中心来保护 sql 数据](../../../security-center/security-center-introduction.md)。

