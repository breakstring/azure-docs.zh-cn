---
title: 将漏洞评估扫描结果存储在可从防火墙和 VNet 后面访问的存储帐户中
description: 提供有关如何将漏洞评估 (VA) 扫描存储在可通过防火墙或 VNet 访问的存储帐户中的说明
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: a4edf94302e063aed7ba539f173ea1364331c4de
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/07/2021
ms.locfileid: "99807509"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>将漏洞评估扫描结果存储在可从防火墙和 VNet 后面访问的存储帐户中
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

如果要限制某些 VNet 或服务对 Azure 中的存储帐户的访问，则需要启用相应的配置，以便对 SQL 数据库或托管实例的漏洞评估 (VA) 扫描可以访问该存储帐户。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>启用 Azure SQL 数据库 VA 扫描对存储帐户的访问权限

如果已将 VA 存储帐户配置为仅可由某些网络或服务访问，则需要确保 Azure SQL 数据库的 VA 扫描能够在存储帐户上存储扫描。 可以使用现有存储帐户，也可以创建新的存储帐户来存储[逻辑 SQL Server](logical-servers.md) 上所有数据库的 VA 扫描结果。

> [!NOTE]
> 如果安全漏洞评估服务需要存储访问密钥，则无法访问使用防火墙或 Vnet 保护的存储帐户。

转到包含存储帐户的“资源组”，然后访问“存储帐户”窗格。 在“设置”下，选择“防火墙和虚拟网络”。

确保已选中“允许受信任的 Microsoft 服务访问此存储帐户”。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="屏幕截图显示了“防火墙和虚拟网络”对话框，其中选中了“允许受信任的 Microsoft 服务访问此存储帐户”。":::

若要确定正在使用的存储帐户，请在 "**安全**" 下的 " **SQL server** [Azure 门户](https://portal.azure.com)" 窗格中选择 "安全 **中心**"。

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="设置漏洞评估":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>将 Azure SQL 托管实例的 VA 扫描结果存储在可从防火墙或 VNet 后面访问的存储帐户中

由于托管实例不是受信任的 Microsoft 服务，并且具有与存储帐户不同的 VNet，执行 VA 扫描将导致错误。

若要在托管实例上支持 VA 扫描，请执行以下步骤：

1. 在“SQL 托管实例”窗格的“概述”标题下，单击“虚拟网络/子网”链接。 这会转到“虚拟网络”窗格。

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. 在“设置”下，选择“子网”。 在新窗格中单击 " **子网** " 以添加子网，并将其委托给 *Sql\managedInstance*。 有关详细信息，请参阅[管理子网](../../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="屏幕截图显示已被委托了 Microsoft.sql\managedInstance 的子网。":::

1. 在“虚拟网络”窗格的“设置”下，选择“服务终结点”。 在新窗格中单击“添加”，然后将“Microsoft.Storage”服务作为新的服务终结点添加。 确保选择了“ManagedInstance”子网。 单击“添加” 。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="屏幕截图显示了“添加服务终结点”，可以在其中添加 Microsoft.Storage 服务作为终结点。":::

1. 转到选择用于存储 VA 扫描的“存储帐户”。 在“设置”下，选择“防火墙和虚拟网络”。 单击“添加现有虚拟网络”。 选择托管实例虚拟网络和子网，然后单击“添加”。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="屏幕截图显示了“防火墙和虚拟网络”窗格，其中包含“添加现有虚拟网络”链接。":::

现在，你应该能够在存储帐户中存储托管实例的 VA 扫描。

## <a name="next-steps"></a>后续步骤

- [漏洞评估](sql-vulnerability-assessment.md)
- [创建 Azure 存储帐户](../../storage/common/storage-account-create.md)
- [Azure Defender for SQL](azure-defender-for-sql.md)
